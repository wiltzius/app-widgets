<!DOCTYPE html>
<link rel="import" href="bower_components/polymer/polymer.html">
<link rel="import" href="bower_components/core-elements/core-elements.html">
<link rel="import" href="bower_components/paper-elements/paper-elements.html">
<polymer-element name="x-flickrstreamer" attributes="height count">
  <template>
    <style>
      core-list {
        height: 100%;
        overflow-y: scroll;
      }
      .item {
        box-sizing: border-box;
        height: {{itemHeight}}px;
        overflow: hidden;
      }
      .shadowbox {
        box-sizing: border-box;
        height: {{itemHeight-16}}px;
        margin-left: 16px;
        margin-top: 8px;
        margin-right: 16px;
      }
      .header-img {
        height: 140px;
        overflow: hidden;
      }
      .header-img .img {
        width: 100%;
      }
      .header-img .description {
        overflow: none;
      }
    </style>
    <core-ajax auto handleAs="json" id="flickrPipe"></core-ajax>
    <core-list id="listInstance" height={{itemHeight}} data="{{items}}">
      <template>
        <!-- the top-level container of the template block must be the same height as
              the app-list's specified height!  -->
        <!-- the data that's referenced here is what must
              be provided by the app-list's dataProvider -->
        <div class="item">
          <div class="shadowbox" on-tap="{{shadowTap}}" on-down="{{shadowGestureDown}}" touch-action="pan-y" on-trackstart="{{shadowGestureStart}}" on-trackend="{{shadowGestureEnd}}" on-track="{{shadowGestureTrack}}">
            <paper-shadow z="1"></paper-shadow>
            <div class="header-img">
              <img src="{{ url_m }}" />
            </div>
            <h3>{{title}}</h3>
            <div class="description">
              {{ description._content }}
            </div>
          </div>

        </div>
      </template>
    <app-list>
  </template>
  <script>
    Polymer('x-flickrstreamer', {
      items: null,
      itemHeight: 240,
      rotation: 0,
      ready: function() {
        this.$.flickrPipe.url = 'https://api.flickr.com/services/rest/';
        this.$.flickrPipe.params = {
          'method': 'flickr.interestingness.getList',
          'extras': ['description','license','date_upload',' date_taken','owner_name','icon_server','original_format','last_update','geo','tags','machine_tags','o_dims','views','media',' path_alias','url_sq','url_t','url_s','url_q','url_m','url_n','url_z','url_c','url_l','url_o]',],
          'format': 'json',
          'per_page': '50',
          'nojsoncallback': 1,
          'api_key': 'bb962ee3ecbe7d27e28fa116a641c245'
          };
        this.$.flickrPipe.addEventListener('core-response', function(e) {
          console.log(e.detail.response.photos.photo);
          this.items = e.detail.response.photos.photo;
        }.bind(this));
      },
      shadowTap: function(e) {
      },
      shadowGestureDown: function(e) {
      },
      shadowGestureTrack: function(e) {
        this.rotation = e.clientX;
        console.log(this.rotation);
      },
      shadowGestureStart: function(e) {
        console.log('began on ' + e.target);
      },
      shadowGestureEnd: function(e) {
        console.log('ended on ' + e.target);
      }
    });
  </script>
</polymer-element>
